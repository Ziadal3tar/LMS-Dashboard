<div class="container-fluid">
  <!-- Header -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
    <div>
      <h4 class="fw-bold">{{ quizTitle }}</h4>
      <p class="text-muted small mb-0">Manage Questions</p>
    </div>

    <div class="d-flex flex-wrap align-items-center gap-2">
  <input type="text" [(ngModel)]="searchTerm" placeholder="Search question..."
         class="form-control form-control-sm" style="width: 220px;">
  <select class="form-select form-select-sm" [(ngModel)]="filterType" style="width: 160px;">
    <option value="All">All Types</option>
    <option value="multiple">Multiple Choice</option>
    <option value="truefalse">True / False</option>
  </select>
  <button class="btn btn-outline-success btn-sm" (click)="exportToExcel()">
    <i class="bi bi-file-earmark-excel"></i> Export to Excel
  </button>
  <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#questionModal"
          (click)="openAddModal()">
    <i class="bi bi-plus-lg"></i> Add Question
  </button>
</div>

  </div>

  <!-- Summary -->
  <div class="mb-3">
    <span class="fw-semibold">{{ filteredQuestions.length }}</span>
    <small class="text-muted">questions found</small>
  </div>

  <!-- Questions Cards -->
  <div class="row g-3">
    <div *ngFor="let q of filteredQuestions; let i = index" class="col-md-6 col-xl-4">
      <div class="card question-card p-3 h-100">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <h6 class="fw-bold mb-0">{{ q.text }}</h6>
          <span class="badge bg-secondary text-capitalize">{{ q.type }}</span>
        </div>

        <ul class="list-unstyled mb-3 small">
          <li *ngFor="let opt of q.options" [class.text-success]="opt === q.correctAnswer">
            <i class="bi" [ngClass]="opt === q.correctAnswer ? 'bi-check-circle-fill' : 'bi-circle'"></i>
            {{ opt }}
          </li>
        </ul>

        <div class="d-flex justify-content-between">
          <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#questionModal"
                  (click)="openEditModal(i)">
            <i class="bi bi-pencil"></i> Edit
          </button>
          <button class="btn btn-outline-danger btn-sm" (click)="deleteQuestion(i)">
            <i class="bi bi-trash"></i> Delete
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="filteredQuestions.length === 0" class="text-center text-muted py-4">
      No questions found for this filter.
    </div>
  </div>
</div>


<!-- Add/Edit Question Modal -->
<div class="modal fade" id="questionModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0">
      <div class="modal-header">
        <h5 class="modal-title">{{ isEditing ? 'Edit Question' : 'Add Question' }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>

      </div>

      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Question Text</label>
          <textarea class="form-control" rows="2" [(ngModel)]="newQuestion.text"></textarea>
        </div>

        <div class="mb-3">
          <label class="form-label">Question Type</label>
          <select class="form-select" [(ngModel)]="newQuestion.type" (change)="onTypeChange()">
            <option value="multiple">Multiple Choice</option>
            <option value="truefalse">True / False</option>
          </select>
        </div>

        <div *ngIf="newQuestion.type === 'multiple'" class="mb-3">
          <label class="form-label">Options</label>
          <div *ngFor="let opt of newQuestion.options; let i = index" class="input-group mb-2">
            <div class="input-group-text">
              <input type="radio" name="correctOption" [value]="opt"
                     [checked]="newQuestion.correctAnswer === opt"
                     (change)="selectCorrectAnswer(opt)">
            </div>
            <input type="text" class="form-control" placeholder="Option {{ i + 1 }}"
                   [(ngModel)]="newQuestion.options[i]">
            <button class="btn btn-outline-danger" type="button" (click)="removeOption(i)">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
          <button class="btn btn-outline-secondary btn-sm" type="button" (click)="addOption()">+ Add Option</button>
        </div>

        <div *ngIf="newQuestion.type === 'truefalse'" class="mb-3">
          <label class="form-label">Select Correct Answer</label>
          <div class="d-flex gap-3 align-items-center">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="tf" id="true" value="True"
                     (change)="selectCorrectAnswer('True')" [checked]="newQuestion.correctAnswer === 'True'">
              <label class="form-check-label" for="true">True</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="tf" id="false" value="False"
                     (change)="selectCorrectAnswer('False')" [checked]="newQuestion.correctAnswer === 'False'">
              <label class="form-check-label" for="false">False</label>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" (click)="saveQuestion()">
          {{ isEditing ? 'Save Changes' : 'Add Question' }}
        </button>
      </div>
    </div>
  </div>
</div>
